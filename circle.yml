dependencies:
  pre:
    - sudo add-apt-repository -y ppa:george-edison55/cmake-3.x
    - sudo apt-get update
    - sudo apt-get install qtbase5-dev qttools5-dev-tools qttools5-dev ninja-build doxygen cmake xsltproc
    - curl -O https://raw.githubusercontent.com/zanata/zanata-tests/master/scripts/CTest2JUnit.xsl

test:
  pre:
    - cmake -G Ninja
    - ninja

  override:
    - ctest -T Test
    - mkdir -p $CIRCLE_TEST_REPORTS/junit/
    - xsltproc CTest2JUnit.xsl `find Testing/ -type f -name Test.xml` > $CIRCLE_TEST_REPORTS/junit/Test.xml

  post:
    - ninja package
    - cp tracelib-* $CIRCLE_ARTIFACTS
